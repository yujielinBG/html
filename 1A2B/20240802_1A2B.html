<html lang="en">
	<head>
	    <title>1A2B</title>
		<meta charset="UTF-8">
		<style>
			canvas { border: 1px solid #000; }
		</style>
	</head>
	<body>
		<canvas id="_Canvas" width="700" height="700"></canvas>
	</body>
</html>


<!--
=======================================================
   Script
=======================================================
-->
<script>

const canvas = document.getElementById('_Canvas');
const ctx = canvas.getContext('2d');

class Result {
	A = 0 ;
	B = 0 ;
}

class ABGame {
	length = 4 ;
	question = [] ;
	answers = [] ;
	results = [] ;
	createGame(length) {
		this.length = length ;
		this.question = [] ;
		this.answers = [] ;
		this.results = [] ;
		this.genQuestion();
	}
	genQuestion() {
		console.log('genQuestion()');
		for( let i=0; i<this.length; i++ ) {
			let isDuplicated = false ;
			do {
				isDuplicated = false ;
				this.question[i] = Math.floor(Math.random()*10);
				console.log( `i=${i} => ${this.question[i]}` ) ;
				for( let j=0; j<i; j++ ) {
					if ( this.question[j] == this.question[i] ) {
						isDuplicated = true ;
						console.log('isDuplicated') ;
						break;
					}
				}
			} while ( isDuplicated ) ;
		}
		console.log( this.question ) ;
	}

	answer(ans) {
		console.log(ans) ;
		let result = new Result() ;
		for( let i=0; i<this.length; i++ ) {
			for ( let j=0; j<this.length; j++ ) {
				if ( ans[i] == this.question[j] ) {
					if ( i==j ) {
						result.A++;
					} else {
						result.B++;
					}
				}
			}
		}
		this.answers.push( ans );
		this.results.push ( result );
		return result ;
	}

}


class Game {
	length = 0 ;
	inputAry = [] ;
	abGame = new ABGame() ;
	constructor() {
		document.addEventListener('keydown', this.keyDownEvent.bind(this) ) ;
	}

	play(length) {
		this.inputAry.length = 0 ;
		this.length = length ;
		this.abGame.createGame(this.length) ;
		this.drawBackground();
	}

	keyDownEvent( event ) {
		if ( event.keyCode >=96 && event.keyCode <= 105 ) {
			if ( this.inputAry.length<this.length ) {
				this.inputAry.push( event.keyCode - 96 );
			}
		} else {
			switch(event.code) {
				case 'Enter':
				case 'NumpadEnter':
					if ( this.inputAry.length != this.length ) {
						return ;
					}
					this.abGame.answer(this.inputAry) ;
					this.inputAry.length = 0;
					break;

				case 'Backspace':
					if ( this.inputAry.length > 0 ) {
						this.inputAry.pop() ;
					}

			}
		}
		this.drawInputField() ;
	}

	drawBackground() {
		ctx.beginPath();
		ctx.fillStyle = 'white';
		ctx.fillRect(300,550,49,49); //
		ctx.stroke();

		ctx.strokeStyle = 'black'; 
		ctx.lineWidth = 1.5 ; 
		for(let i = 0 ; i < 4 ; i++ ){
			ctx.moveTo(200+100*i,600);
			ctx.lineTo(250+100*i,600);
		}
		ctx.stroke();

		ctx.font = "40px 微軟正黑體";
		ctx.textAlign = "left";
		ctx.textBaseline = "bottom";
		for(let i = 0 ; i < 10 ; i++ ){
			ctx.fillText(i, 70*i, 680);
		}
	}

	drawInputField() {
		ctx.fillStyle = 'white';
		for( let i=0; i<this.length; i++ ) {
			ctx.fillRect(200+100*i,550,49,49); //
		}
		ctx.fillStyle = 'black';
		ctx.font = "40px 微軟正黑體";
		ctx.textAlign = "left";
		ctx.textBaseline = "bottom";
		for( let i=0; i<this.inputAry.length; i++ ) {
			ctx.fillText( this.inputAry[i], 200+100*i, 600);
		}
	}

	drawHistory(){
		ctx.font = "20px 新細明體";
		ctx.textAlign = "left";
		ctx.textBaseline = "top";
		ctx.fillText(this.row, this.x, this.y);
		this.x += 15 ;
		ctx.fillText(".", this.x, this.y);
		this.x += 20 ;
		ctx.font = "23px 微軟正黑體";
		for(let i = 0 ; i < 4 ; i++ ){
			ctx.fillText(answer[i], this.x, this.y);
			this.x += 20;
		}
		this.x += 20 ;
		ctx.fillText(this.A, this.x, this.y);
		this.x += 20 ;
		ctx.fillText("A", this.x, this.y);
		this.x += 20 ;
		ctx.fillText(this.B, this.x, this.y);
		this.x += 20 ;
		ctx.fillText("B", this.x, this.y);
		this.row ++ ;
		this.y += 25;
	}
}

let game = new Game() ;
game.play(4);

</script> 